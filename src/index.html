<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3Graph</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="phone_box"></div>

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script>
    const container = document.querySelector('.phone_box');
    const colors = {
      'person': '#2e86c1',
      'call': '#cb4335'
    };
    const width = container.clientWidth;
    const height = container.scrollHeight;

    const svg = d3.select('.phone_box').append('svg')
      .attr('width', width)
      .attr('height', height);

    d3.json('./summertime_calls.json')
      .then(build);

    function build(data) {
      generate(data);

      const simulation = d3.forceSimulation()
        .force('charge', d3.forceManyBody().strength(-100))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('link', d3.forceLink().id(d => d.id).distance(150))
        .on('tick', ticked);

      simulation.nodes(data.nodes);
      simulation.force('link').links(data.relationships);
    }

    function generate(data) {
      const link = svg.selectAll('.link')
          .data(data.relationships)
        .enter().append('line')
          .attr('class', 'link')
          .attr('stroke', '#7a787d');

      const node = svg.selectAll('.node')
          .data(data.nodes)
        .enter().append('g')
          .attr('class', 'node');

      node.append('circle')
        .attr('r', d => d.type === 'person' ? 32 : 22)
        .style('fill', d => d.type === 'person'
          ? colors.person
          : colors.call
        )

      node.append('text')
        .text(d => d.name || d.id)
        .attr('class', 'title')
        .attr('text-anchor', 'middle')
        .attr('dy', '.35em');
    }

    function ticked() {
      d3.selectAll('.link')
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      d3.selectAll('.node')
        .attr("transform", d => `translate(${+d.x}, ${+d.y})`);
    }
  </script>
</body>
</html>
